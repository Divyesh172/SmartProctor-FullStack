version: '3.8'

services:
  # 1. DATABASE
  proctor_db:
    image: postgres:15
    container_name: proctor_db
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
      POSTGRES_DB: proctordb
    volumes:
      - postgres_data:/var/lib/postgresql/data
    network_mode: "host"
    restart: always

  # 2. JAVA BACKEND (Uses your manually built image)
  backend:
    image: smartproctor-fullstack-backend
    container_name: proctor_backend
    depends_on:
      - proctor_db
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://localhost:5432/proctordb
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: password
      SPRING_JPA_HIBERNATE_DDL_AUTO: update
    network_mode: "host"
    restart: on-failure

  # 3. FRONTEND (Uses your manually built image)
  frontend:
    image: smartproctor-fullstack-frontend
    container_name: proctor_frontend
    network_mode: "host"
    stdin_open: true
    tty: true

  # 4. GO ENGINE (Uses your manually built image)
  go-engine:
    image: smartproctor-go
    container_name: proctor_go
    depends_on:
      - backend
    network_mode: "host"
    restart: always

volumes:
  postgres_data: